<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Timing Scroll Trigger Test - Security Audit 9.1</title>
    <style>
        body {
            padding: 20px;
            font-family: Arial, sans-serif;
        }

        .spacer {
            height: 1000px;
            background: linear-gradient(to bottom, #f0f0f0, #ffffff);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: #666;
        }

        .trigger-zone {
            height: 500px;
            background: #ffeeee;
            padding: 20px;
            border: 3px solid red;
        }

        .injected-link {
            color: red;
            font-weight: bold;
            font-size: 18px;
            display: block;
            margin: 10px 0;
        }
    </style>
</head>

<body>
    <h1>Timing Attack - Scroll Trigger</h1>
    <p>Malicious links will inject when user scrolls to 50% of page.</p>

    <div class="spacer">
        ↓ Scroll Down ↓
    </div>

    <div class="trigger-zone" id="trigger-zone">
        <h2>Trigger Zone (50% of page)</h2>
        <p>Links will appear here when scrolled into view...</p>
        <div id="injection-point"></div>
    </div>

    <div class="spacer">
        Test Complete
    </div>

    <script>
        let injected = false;

        function checkScroll() {
            if (injected) return;

            const scrollPercent = (window.scrollY / (document.body.scrollHeight - window.innerHeight)) * 100;

            if (scrollPercent >= 40) { // Trigger at 40% scroll
                console.log('[TIMING SCROLL] Scroll threshold reached - injecting malicious links');
                injectLinks();
                injected = true;
            }
        }

        function injectLinks() {
            const injectionPoint = document.getElementById('injection-point');
            const startTime = performance.now();

            const maliciousUrls = [
                'http://scroll-triggered-phishing.com/login',
                'http://delayed-injection.malicious.net/verify',
                'http://timing-attack.evil.org/account',
                'http://scroll-based-evasion.scam.com/secure',
                'http://late-link-injection.phish.net/confirm'
            ];

            maliciousUrls.forEach((url, index) => {
                const link = document.createElement('a');
                link.href = url;
                link.className = 'injected-link';
                link.textContent = `⚠️ INJECTED LINK ${index + 1}: ${url}`;
                injectionPoint.appendChild(link);
            });

            const endTime = performance.now();
            console.log(`[TIMING SCROLL] Injected ${maliciousUrls.length} links in ${(endTime - startTime).toFixed(2)}ms`);

            document.querySelector('.trigger-zone p').textContent =
                `✓ ${maliciousUrls.length} malicious links injected at ${new Date().toISOString()}`;
        }

        // Listen for scroll events
        window.addEventListener('scroll', checkScroll);

        console.log('[TIMING SCROLL] Listening for scroll events...');
    </script>
</body>

</html>